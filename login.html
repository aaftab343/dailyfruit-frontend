<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login ‚Äî Daily Fruit Co.</title>

  <!-- TAILWIND -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    body{
      font-family:'Inter',sans-serif;
      background:linear-gradient(180deg,#f8fafc,#eef7ff);
    }
    .glass{
      background:rgba(255,255,255,0.9);
      backdrop-filter:blur(12px);
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.4);
      box-shadow:0 10px 30px rgba(15,23,42,0.12);
    }
    .section-title{
      background:linear-gradient(90deg,#06b6d4,#7c3aed);
      -webkit-background-clip:text;
      color:transparent;
      font-weight:800;
    }
    .active-tab{
      background:linear-gradient(90deg,#06b6d4,#7c3aed);
      color:white !important;
      font-weight:700;
      border-radius:6px;
    }
    .eye-icon{
      position:absolute;
      right:12px;
      top:38px;
      cursor:pointer;
      font-size:20px;
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <a href="index.html" class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-teal-400 text-white flex items-center justify-center font-bold shadow">
        DF
      </div>
      <div>
        <h1 class="text-lg font-semibold">Daily Fruit Co.</h1>
        <p class="text-xs text-gray-500">Freshness Delivered Daily</p>
      </div>
    </a>

    <nav class="hidden md:flex gap-4 text-sm">
      <a href="index.html" class="hover:text-green-600">Home</a>
      <a href="plans.html" class="hover:text-emerald-600">Plans</a>
      <a href="login.html" class="hover:text-indigo-600 font-bold">Login</a>
      <a href="signup.html" class="hover:text-indigo-600">Signup</a>
      <a href="dashboard.html" class="hover:text-emerald-600">Dashboard</a>
    </nav>
  </div>
</header>

<!-- PAGE TITLE -->
<section class="max-w-6xl mx-auto px-4 py-8">
  <h2 class="text-3xl md:text-4xl font-extrabold section-title">Login to Your Account</h2>
  <p class="text-gray-600 text-sm md:text-base mt-1">Access your fruit plans, profile, and checkout.</p>
</section>

<!-- LOGIN BOX -->
<section class="max-w-3xl mx-auto px-4 pb-10">
  <div class="glass p-6 md:p-8">

    <!-- TABS -->
    <div class="flex border-b mb-6">
      <button id="tabPassword" class="flex-1 text-center py-2 text-sm font-medium hover:bg-gray-100">Login with Password</button>
      <button id="tabOtp" class="flex-1 text-center py-2 text-sm font-medium hover:bg-gray-100">Login with OTP</button>
    </div>

    <div id="loginContent"></div>

<script>
const API_BASE = "https://dailyfruit-backend.onrender.com";

const loginContent = document.getElementById("loginContent");
const tabPassword = document.getElementById("tabPassword");
const tabOtp = document.getElementById("tabOtp");

// Default = Password
showPasswordLogin();
tabPassword.classList.add("active-tab");

tabPassword.onclick = () => {
  tabPassword.classList.add("active-tab");
  tabOtp.classList.remove("active-tab");
  showPasswordLogin();
};
tabOtp.onclick = () => {
  tabOtp.classList.add("active-tab");
  tabPassword.classList.remove("active-tab");
  showOtpLogin();
};


/* ---------------------------------------------
   PASSWORD LOGIN (EMAIL ONLY)
--------------------------------------------- */
function showPasswordLogin(){
  loginContent.innerHTML = `
    <form id="passwordLoginForm" class="space-y-4 relative">

      <div>
        <label class="text-sm font-medium">Email *</label>
        <input type="email" id="emailLogin" required class="w-full border rounded-md px-3 py-2 bg-white/80">
      </div>

      <div class="relative">
        <label class="text-sm font-medium">Password *</label>
        <input type="password" id="passwordLogin" required class="w-full border rounded-md px-3 py-2 bg-white/80">
        <span id="togglePass" class="eye-icon">üëÅÔ∏è</span>
      </div>

      <button class="w-full mt-3 px-4 py-2 rounded-full text-white"
              style="background:linear-gradient(90deg,#06b6d4,#7c3aed);">Login</button>

      <p class="text-xs text-gray-500 text-center mt-3">
        Don't have an account? <a href="signup.html" class="text-indigo-600 underline">Create one</a>
      </p>
    </form>
  `;

  const togglePass = document.getElementById("togglePass");
  const passInput = document.getElementById("passwordLogin");

  togglePass.onclick = () => {
    passInput.type = passInput.type === "password" ? "text" : "password";
    togglePass.textContent = passInput.type === "password" ? "üëÅÔ∏è" : "üôà";
  };

  document.getElementById("passwordLoginForm").onsubmit = passwordLogin;
}


// BACKEND LOGIN
async function passwordLogin(e){
  e.preventDefault();

  const email = document.getElementById("emailLogin").value.trim().toLowerCase();
  const password = document.getElementById("passwordLogin").value.trim();

  const res = await fetch(API_BASE + "/api/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  });

  const data = await res.json();

  if (!res.ok) {
    alert(data.message || "Login failed");
    return;
  }

  // SAVE FOR DASHBOARD
  localStorage.setItem("df_token", data.token);

  localStorage.setItem("df_user_profile", JSON.stringify({
    fullName: data.user.name,
    email: data.user.email,
    phone: data.user.phone,
    deliveryTime: data.user.deliveryTime,
    address: data.user.address
  }));

  alert("Login successful!");
  window.location.href = "dashboard.html";
}



/* ---------------------------------------------
   OTP LOGIN (EMAIL ONLY)
--------------------------------------------- */
function showOtpLogin(){
  loginContent.innerHTML = `
    <form id="otpLoginForm" class="space-y-4">
      <div>
        <label class="text-sm font-medium">Email *</label>
        <input type="email" id="otpEmail" required class="w-full border rounded-md px-3 py-2 bg-white/80">
      </div>

      <button type="button" id="sendOtpBtn" class="w-full px-4 py-2 rounded-full text-white" style="background:linear-gradient(90deg,#06b6d4,#7c3aed);">Send OTP</button>
      <p id="otpStatus" class="text-xs text-gray-600"></p>

      <div id="otpBox" class="hidden">
        <label class="text-sm font-medium">Enter OTP</label>
        <input type="text" id="otpInput" class="w-full border rounded-md px-3 py-2 bg-white/80">

        <button class="w-full mt-3 px-4 py-2 rounded-full text-white"
                style="background:linear-gradient(90deg,#06b6d4,#7c3aed);">
          Verify OTP & Login
        </button>
      </div>
    </form>
  `;

  document.getElementById("sendOtpBtn").onclick = sendOtpBackend;
  document.getElementById("otpLoginForm").onsubmit = verifyOtpBackend;
}


// SEND OTP (backend)
async function sendOtpBackend(){
  const email = document.getElementById("otpEmail").value.trim().toLowerCase();
  const status = document.getElementById("otpStatus");

  const res = await fetch(API_BASE + "/api/auth/login-otp/start", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  });

  const data = await res.json();

  if (!res.ok) {
    status.textContent = data.message;
    status.className = "text-xs text-red-600";
    return;
  }

  status.textContent = "OTP sent to email ‚úî";
  status.className = "text-xs text-green-600";
  document.getElementById("otpBox").classList.remove("hidden");
}


// VERIFY OTP (backend)
async function verifyOtpBackend(e){
  e.preventDefault();

  const email = document.getElementById("otpEmail").value.trim().toLowerCase();
  const otp = document.getElementById("otpInput").value.trim();

  const res = await fetch(API_BASE + "/api/auth/login-otp/verify", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, otp })
  });

  const data = await res.json();

  if (!res.ok) {
    alert(data.message || "Invalid OTP");
    return;
  }

  // SAVE FOR DASHBOARD
  localStorage.setItem("df_token", data.token);

  localStorage.setItem("df_user_profile", JSON.stringify({
    fullName: data.user.name,
    email: data.user.email,
    phone: data.user.phone,
    deliveryTime: data.user.deliveryTime,
    address: data.user.address
  }));

  alert("OTP Verified! Login Successful.");
  window.location.href = "dashboard.html";
}
</script>

  </div>
</section>

</body>
</html>
