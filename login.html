<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login ‚Äî Daily Fruit Co.</title>

  <!-- TAILWIND -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    body{
      font-family:'Inter',sans-serif;
      background:linear-gradient(180deg,#f8fafc,#eef7ff);
    }
    .glass{
      background:rgba(255,255,255,0.9);
      backdrop-filter:blur(12px);
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.4);
      box-shadow:0 10px 30px rgba(15,23,42,0.12);
    }
    .eye-btn {
      position:absolute;
      right:12px;
      top:50%;
      transform:translateY(-50%);
      cursor:pointer;
      font-size:20px;
    }
    .active-tab {
      border-bottom:3px solid #7c3aed;
      color:#7c3aed;
    }
    .btn-clicked {
      opacity:0.7;
    }
  </style>
</head>

<body>

<!-- HEADER -->
<header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <a href="index.html" class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-teal-400 text-white flex items-center justify-center font-bold shadow">
        DF
      </div>
      <div>
        <h1 class="text-lg font-semibold">Daily Fruit Co.</h1>
        <p class="text-xs text-gray-500">Freshness Delivered Daily</p>
      </div>
    </a>
  </div>
</header>

<section class="max-w-3xl mx-auto px-4 py-10">
  <h2 class="text-4xl font-extrabold text-center text-cyan-600 mb-6">Login</h2>

  <div class="glass p-6 md:p-8 space-y-6">

    <!-- TABS -->
    <div class="flex border-b mb-4">
      <button id="tabPassword" class="flex-1 text-center py-2 font-medium active-tab">Password Login</button>
      <button id="tabOtp" class="flex-1 text-center py-2 font-medium">OTP Login</button>
    </div>

    <div id="loginContent"></div>

  </div>
</section>

<script>
const API_BASE = "https://dailyfruit-backend.onrender.com";

/**********************************************
 * TAB SWITCHING
 **********************************************/
showPasswordLogin();
document.getElementById("tabPassword").onclick = () => {
  document.getElementById("tabPassword").classList.add("active-tab");
  document.getElementById("tabOtp").classList.remove("active-tab");
  showPasswordLogin();
};
document.getElementById("tabOtp").onclick = () => {
  document.getElementById("tabOtp").classList.add("active-tab");
  document.getElementById("tabPassword").classList.remove("active-tab");
  showOtpLogin();
};

/**********************************************
 * SHOW/HIDE PASSWORD FUNCTION
 **********************************************/
function togglePassword(inputId, iconId) {
  const input = document.getElementById(inputId);
  const icon = document.getElementById(iconId);

  if (input.type === "password") {
    input.type = "text";
    icon.textContent = "üôà";
  } else {
    input.type = "password";
    icon.textContent = "üëÅÔ∏è";
  }
}

/**********************************************
 * PASSWORD LOGIN UI
 **********************************************/
function showPasswordLogin(){
  loginContent.innerHTML = `
    <form id="passwordLoginForm" class="space-y-4">

      <div>
        <label class="text-sm font-medium">Email *</label>
        <input type="email" id="loginEmail" required
               class="w-full border rounded-md px-3 py-2 bg-white/80">
      </div>

      <div class="relative">
        <label class="text-sm font-medium">Password *</label>
        <input type="password" id="loginPassword" required
               class="w-full border rounded-md px-3 py-2 bg-white/80">

        <span id="togglePass" class="eye-btn">üëÅÔ∏è</span>
      </div>

      <button id="loginBtn" class="w-full mt-3 px-4 py-2 rounded-full text-white text-lg font-semibold"
              style="background:linear-gradient(90deg,#06b6d4,#7c3aed); transition:.25s;">
        Login
      </button>

      <p class="text-xs text-gray-500 text-center mt-3">
        Don't have an account?
        <a href="signup.html" class="text-indigo-600 underline">Create one</a>
      </p>

    </form>
  `;

  document.getElementById("passwordLoginForm").onsubmit = passwordLogin;
  document.getElementById("togglePass").onclick = () => togglePassword("loginPassword", "togglePass");
}

/**********************************************
 * PASSWORD LOGIN FUNCTION
 **********************************************/
async function passwordLogin(e){
  e.preventDefault();

  const btn = document.getElementById("loginBtn");
  btn.classList.add("btn-clicked");

  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value;

  try {
    const res = await fetch(`${API_BASE}/api/auth/login`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.message || "Invalid login");
      btn.classList.remove("btn-clicked");
      return;
    }

    const sessionExpiry = Date.now() + 30 * 60 * 1000;
    localStorage.setItem("df_session_expiry", sessionExpiry);
    localStorage.setItem("df_user_profile", JSON.stringify(data.user));
    localStorage.setItem("df_user_token", data.token);

    alert("Login successful!");
    window.location.href = "index.html";

  } catch (err) {
    alert("Network error");
  }
}

/**********************************************
 * OTP LOGIN UI
 **********************************************/
function showOtpLogin(){
  loginContent.innerHTML = `
    <form id="otpLoginForm" class="space-y-4">

      <div>
        <label class="text-sm font-medium">Email *</label>
        <input type="email" id="otpEmail" required
               class="w-full border rounded-md px-3 py-2 bg-white/80">
      </div>

      <button type="button" id="sendOtpBtn"
              class="w-full px-4 py-2 rounded-full text-white"
              style="background:linear-gradient(90deg,#06b6d4,#7c3aed);">
        Send OTP
      </button>

      <p id="otpStatus" class="text-xs text-gray-600"></p>

      <div id="otpBox" class="hidden">
        <label class="text-sm font-medium">Enter OTP</label>
        <input type="text" id="otpInput"
               class="w-full border rounded-md px-3 py-2 bg-white/80">

        <button class="w-full mt-3 px-4 py-2 rounded-full text-white"
                style="background:linear-gradient(90deg,#06b6d4,#7c3aed);">
          Verify OTP & Login
        </button>
      </div>

    </form>
  `;

  document.getElementById("sendOtpBtn").onclick = sendOtp;
  document.getElementById("otpLoginForm").onsubmit = verifyOtp;
}

/**********************************************
 * SEND OTP
 **********************************************/
async function sendOtp(){
  const email = document.getElementById("otpEmail").value.trim();
  const status = document.getElementById("otpStatus");

  const res = await fetch(`${API_BASE}/api/auth/login-otp/start`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email })
  });

  const data = await res.json();

  if(!res.ok){
    status.textContent = data.message || "Error sending OTP";
    status.className = "text-xs text-red-600";
    return;
  }

  status.textContent = "OTP sent to your email.";
  status.className = "text-xs text-emerald-600";
  document.getElementById("otpBox").classList.remove("hidden");
}

/**********************************************
 * VERIFY OTP
 **********************************************/
async function verifyOtp(e){
  e.preventDefault();

  const email = document.getElementById("otpEmail").value.trim();
  const otp = document.getElementById("otpInput").value.trim();

  const res = await fetch(`${API_BASE}/api/auth/login-otp/verify`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email, otp })
  });

  const data = await res.json();

  if(!res.ok){
    alert(data.message || "Invalid OTP");
    return;
  }

  const sessionExpiry = Date.now() + 30 * 60 * 1000;
  localStorage.setItem("df_session_expiry", sessionExpiry);
  localStorage.setItem("df_user_profile", JSON.stringify(data.user));
  localStorage.setItem("df_user_token", data.token);

  alert("OTP Verified!");
  window.location.href = "index.html";
}
</script>

</body>
</html>
