<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Plans — Daily Fruit Co.</title>

<!-- TAILWIND -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- FONTS -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- FONTAWESOME -->
<script src="https://kit.fontawesome.com/0c9b1f3f2d.js" crossorigin="anonymous"></script>

<style>
  body{
    font-family:'Inter',sans-serif;
    background:linear-gradient(180deg,#f8fafc,#eef7ff);
  }
  .glass{
    position:relative;
    background:rgba(255,255,255,0.9);
    backdrop-filter:blur(12px);
    border-radius:18px;
    border:1px solid rgba(148,163,184,0.4);
    box-shadow:0 10px 30px rgba(15,23,42,0.12);
    overflow:hidden;
  }
  .badge-floating{
    position:absolute;top:10px;left:10px;padding:4px 9px;
    font-size:10px;background:#ffffffcc;
    backdrop-filter:blur(6px);border:1px solid rgba(148,163,184,0.4);
    border-radius:9999px;z-index:10;font-weight:700;
  }
  .badge-under{
    display:inline-block;margin-top:6px;padding:2px 8px;font-size:10px;
    background:#e6fffa;color:#0f766e;border-radius:9999px;
  }
  .card-hover{transition:.25s ease;cursor:pointer;}
  .card-hover:hover{transform:translateY(-5px);box-shadow:0 16px 40px rgba(15,23,42,0.2);}
  .section-title{
    background:linear-gradient(90deg,#06b6d4,#7c3aed);
    -webkit-background-clip:text;color:transparent;font-weight:800;
  }
  .sticky-filter{
    position:sticky;top:0;z-index:30;
    background:rgba(255,255,255,0.95);
    backdrop-filter:blur(8px);
    border-bottom:1px solid #e2e8f0;
  }
  .btn-select{
    background:linear-gradient(90deg,#06b6d4,#7c3aed);
    color:white;font-size:11px;
  }
</style>
</head>

<body>

<script>
const params = new URLSearchParams(window.location.search);
const openedFromDashboard = params.get("from") === "dashboard";
const token = localStorage.getItem("df_user_token");
if (!token && !openedFromDashboard) {
  window.location.href = "signup.html?redirect=plans.html";
}
</script>

<!-- HEADER -->
<header id="headerBar" class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <a href="index.html" class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-teal-400 text-white flex items-center justify-center font-bold shadow">DF</div>
      <div>
        <h1 class="text-lg font-semibold">Daily Fruit Co.</h1>
        <p class="text-xs text-gray-500">Freshness Delivered Daily</p>
      </div>
    </a>
  </div>
</header>

<script>
if (openedFromDashboard) {
  document.getElementById("headerBar").style.display = "none";
}
</script>

<!-- PAGE HEADING -->
<section class="max-w-6xl mx-auto px-4 py-8">
  <h2 class="text-3xl md:text-4xl font-extrabold section-title mb-2">
    All Subscription Plans
  </h2>
  <p class="text-gray-600 text-sm md:text-base">
    Choose based on your goal — weight loss, premium fruits, detox or daily immunity.
  </p>
</section>

<!-- FILTER BAR -->
<div class="sticky-filter">
  <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col md:flex-row gap-3 items-center justify-between">

    <input id="searchInput" onkeyup="filterPlans()" type="text"
           placeholder="Search plans…" class="px-4 py-2 w-full md:w-72 border rounded">

    <select id="categoryFilter" onchange="filterPlans()"
            class="px-4 py-2 border rounded w-full md:w-auto">
      <option value="" selected>All Categories</option>
      <option value="weekly">Weekly</option>
      <option value="monthly">Monthly</option>
      <option value="premium">Premium</option>
      <option value="weight">Weight Goals</option>
      <option value="fitness">Fitness</option>
      <option value="detox">Detox</option>
    </select>
  </div>
</div>

<!-- ✅ DYNAMIC PLANS GRID -->
<div id="plansGrid" class="max-w-6xl mx-auto px-4 pb-16 grid md:grid-cols-2 lg:grid-cols-3 gap-6 text-sm text-gray-700">
  <p id="plansLoading" class="text-xs text-gray-400">Loading plans…</p>
</div>

<script>
const API_BASE = "https://dailyfruit-backend.onrender.com";
let ALL_PLANS = [];

async function loadPlansFromDB(){
  const grid = document.getElementById("plansGrid");

  try{
    const res = await fetch(API_BASE + "/api/plans");
    const plans = await res.json();
    ALL_PLANS = plans;

    grid.innerHTML = "";

    if(!plans || plans.length === 0){
      grid.innerHTML = "<p class='text-xs text-gray-400'>No plans found.</p>";
      return;
    }

    plans.forEach(plan => {
      const card = document.createElement("div");
      card.className = "glass p-5 card-hover";
      card.dataset.title = plan.name;
      card.dataset.category = plan.type || "";

      const durationText =
        plan.durationDays === 7 ? "per week" :
        plan.durationDays ? `for ${plan.durationDays} days` :
        "per month";

      card.innerHTML = `
        ${plan.tags?.length ? `<div class="badge-floating">${plan.tags[0]}</div>` : ""}
        <div class="relative flex gap-4 items-center">
          <img src="${plan.imageUrl || 'https://images.unsplash.com/photo-1572441710534-680f9c6b3f95'}"
               class="w-24 h-24 md:w-28 md:h-28 rounded-xl object-cover border shadow">
          <div class="flex-1">
            <h3 class="font-bold text-lg">${plan.name}</h3>
            ${plan.description ? `<p class="mt-1 text-xs text-gray-500">${plan.description}</p>` : ""}
            <p class="mt-1 font-semibold text-emerald-600">₹${plan.price}</p>
            <p class="text-[11px] text-gray-400">${durationText}</p>
            <button class="select-plan-btn mt-3 px-3 py-1.5 rounded-full btn-select">
              Go to Checkout →
            </button>
          </div>
        </div>
      `;

      card.querySelector(".select-plan-btn").onclick = () => {
        localStorage.setItem("df_selected_plan", JSON.stringify(plan));
        window.location.href = "checkout.html";
      };

      grid.appendChild(card);
    });

  }catch(err){
    console.error("Plan load error:", err);
    grid.innerHTML = "<p class='text-xs text-red-500'>Failed to load plans</p>";
  }
}

function filterPlans(){
  const s = searchInput.value.toLowerCase();
  const cat = categoryFilter.value;
  const cards = Array.from(plansGrid.children);

  cards.forEach(card => {
    const title = card.dataset.title.toLowerCase();
    const c = card.dataset.category.toLowerCase();
    card.style.display =
      title.includes(s) && (!cat || c.includes(cat)) ? "block" : "none";
  });
}

document.addEventListener("DOMContentLoaded", loadPlansFromDB);
</script>

</body>
</html>
