<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>All Plans — Daily Fruit Co.</title>

<!-- TAILWIND -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- FONTS -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- FONTAWESOME -->
<script src="https://kit.fontawesome.com/0c9b1f3f2d.js" crossorigin="anonymous"></script>

<style>
  :root{
    --accent-from:#06b6d4;
    --accent-to:#7c3aed;
    --muted:#94a3b8;
  }
  body{
    font-family:'Inter',sans-serif;
    background:linear-gradient(180deg,#f8fafc,#eef7ff);
    color:#0f172a;
  }

  .glass{
    position:relative;
    background:rgba(255,255,255,0.95);
    border-radius:16px;
    border:1px solid rgba(148,163,184,0.18);
    box-shadow:0 10px 30px rgba(2,6,23,0.06);
    transition:0.25s ease;
  }
  .glass:hover{
    transform:translateY(-6px);
    box-shadow:0 20px 50px rgba(2,6,23,0.10);
  }

  .badge-floating{
    position:absolute; top:12px; left:12px; padding:6px 12px;
    font-size:12px; background:white; border-radius:999px;
    border:1px solid #e2e8f0; font-weight:700;
  }

  .promo-badge{
    padding:6px 10px; border-radius:999px;
    background:linear-gradient(90deg,#fb923c,#f97316);
    color:white; font-size:12px; font-weight:700;
  }

  .day-badge{
    min-width:34px; height:34px; border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    font-size:12px; font-weight:700;
    background:white; border:1px solid #e2e8f0;
  }
  .day-badge.active{
    background:linear-gradient(90deg,var(--accent-from),var(--accent-to));
    color:white; border:none;
  }

  .tooltip-wrapper{position:relative;}
  .tooltip{
    position:absolute; bottom:120%; left:50%;
    transform:translateX(-50%);
    background:#111827; color:white;
    padding:6px 10px; font-size:12px;
    border-radius:6px; white-space:nowrap;
    opacity:0; transition:.2s;
  }
  .tooltip-wrapper:hover .tooltip{
    opacity:1;
  }

  /* Sticky checkout bar */
  #checkoutBar{
    position:fixed; bottom:0; left:0; right:0;
    background:white;
    box-shadow:0 -4px 20px rgba(0,0,0,0.08);
    border-top:1px solid #e2e8f0;
    padding:12px; display:none; z-index:50;
  }
</style>
</head>

<body>

<!-- HEADER -->
<header class="sticky top-0 bg-white/80 backdrop-blur border-b z-40">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
    <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-teal-400 rounded-full text-white flex items-center justify-center font-bold">DF</div>
    <div>
      <h1 class="text-lg font-semibold">Daily Fruit Co.</h1>
      <p class="text-xs text-gray-500">Freshness Delivered Daily</p>
    </div>
  </div>
</header>

<!-- PAGE TITLE -->
<section class="max-w-6xl mx-auto px-4 py-8">
  <h2 class="text-3xl font-extrabold section-title">All Subscription Plans</h2>
  <p class="text-gray-600 mt-1 text-sm">Choose based on your goal — weight loss, premium fruits, detox or daily immunity.</p>
</section>

<!-- FILTER BAR -->
<div class="sticky top-0 z-30 bg-white/90 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col md:flex-row gap-3 items-center justify-between">
    <input id="searchInput" onkeyup="filterPlans()" class="px-4 py-2 border rounded-lg w-full md:w-72"
           placeholder="Search plans..." />

    <select id="categoryFilter" onchange="filterPlans()" class="px-4 py-2 border rounded-lg w-full md:w-auto">
      <option value="">All Categories</option>
      <option value="weekly">Weekly</option>
      <option value="monthly">Monthly</option>
      <option value="premium">Premium</option>
      <option value="detox">Detox</option>
      <option value="fitness">Fitness</option>
      <option value="weight">Weight Goals</option>
    </select>
  </div>
</div>

<!-- PLANS -->
<div id="plansGrid" class="max-w-6xl mx-auto px-4 pb-32 grid md:grid-cols-2 lg:grid-cols-3 gap-6">
  <p id="plansLoading" class="text-gray-400 text-sm">Loading plans...</p>
</div>

<!-- STICKY CHECKOUT BAR -->
<div id="checkoutBar">
  <div class="max-w-4xl mx-auto flex items-center justify-between">
    <div class="flex items-center gap-3">
      <img id="checkoutThumb" src="" class="w-14 h-14 rounded-lg border object-cover" />
      <div>
        <div id="checkoutName" class="font-bold text-sm"></div>
        <div id="checkoutMeta" class="text-xs text-gray-500"></div>
      </div>
    </div>

    <div class="flex items-center gap-4">
      <div id="checkoutPrice" class="font-extrabold text-emerald-600 text-lg"></div>
      <button id="checkoutGo" class="px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium">
        Go to Checkout →
      </button>
      <button onclick="closeCheckout()" class="text-gray-500 text-xl">&times;</button>
    </div>
  </div>
</div>

<script>
const API_BASE = "https://dailyfruit-backend.onrender.com";
let ALL_PLANS = [];

/* Format ₹ */
function rupee(n){ return "₹" + Number(n).toLocaleString("en-IN"); }

/* Delivery days */
function getDeliverySet(plan){
  const arr = plan.deliveryDays?.length ? plan.deliveryDays : ["Mon","Tue","Wed","Thu","Fri","Sat"];
  return new Set(arr.map(x => x.slice(0,3)));
}

/* Load plans */
async function loadPlans(){
  const grid = document.getElementById("plansGrid");
  const res = await fetch(API_BASE + "/api/plans");
  const plans = await res.json();
  ALL_PLANS = plans;
  grid.innerHTML = "";

  plans.forEach(plan => {
    const billingDays = plan.billingDaysPerMonth || plan.durationDays || 30;
    const perDelivery = Math.round(plan.price / billingDays);

    const dset = getDeliverySet(plan);
    const dayOrder = ["Mon","Tue","Wed","Thu","Fri","Sat"];

    const card = document.createElement("div");
    card.className = "glass p-5";
    card.dataset.title = plan.name.toLowerCase();
    card.dataset.category = (plan.type || "").toLowerCase();

    card.innerHTML = `
      ${plan.promo ? `<div class="promo-badge absolute top-3 right-3">${plan.promo}</div>` : ""}
      <div class="badge-floating">${plan.tags?.[0] || ""}</div>

      <div class="flex gap-4 items-start">
        <img src="${plan.imageUrl}" class="w-24 h-24 rounded-lg border object-cover" />

        <div class="flex-1">
          <h3 class="font-bold text-lg">${plan.name}</h3>
          <p class="text-xs text-gray-500 mt-1">${plan.description || ""}</p>

          <div class="mt-3">
            <p class="text-emerald-600 text-xl font-extrabold">${rupee(plan.price)}</p>
            <p class="text-xs text-gray-400">${plan.billingLabel}</p>
            <p class="text-xs text-gray-500">≈ ${rupee(perDelivery)} / delivery</p>
          </div>

          <div class="flex gap-2 mt-3 tooltip-wrapper">
            ${dayOrder.map(d => `
              <div class="day-badge ${dset.has(d) ? "active" : ""}">${d}</div>
            `).join("")}

            <span class="tooltip">${plan.billingLabel}</span>
          </div>

          <button class="mt-4 px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 text-white text-sm font-medium"
            onclick='selectPlan(${JSON.stringify(plan)})'>
            Go to Checkout →
          </button>
        </div>
      </div>
    `;

    grid.appendChild(card);
  });
}

/* Sticky checkout bar */
function selectPlan(plan){
  document.getElementById("checkoutThumb").src = plan.imageUrl;
  document.getElementById("checkoutName").innerText = plan.name;
  document.getElementById("checkoutMeta").innerText = plan.billingLabel;
  document.getElementById("checkoutPrice").innerText = rupee(plan.price);

  document.getElementById("checkoutGo").onclick = () => {
    localStorage.setItem("df_selected_plan", JSON.stringify(plan));
    window.location.href = "checkout.html";
  };

  document.getElementById("checkoutBar").style.display = "block";
}

function closeCheckout(){
  document.getElementById("checkoutBar").style.display = "none";
}

/* Filtering */
function filterPlans(){
  const s = document.getElementById("searchInput").value.toLowerCase();
  const c = document.getElementById("categoryFilter").value;

  document.querySelectorAll("#plansGrid > div").forEach(card => {
    const match =
      card.dataset.title.includes(s) &&
      (!c || card.dataset.category.includes(c));

    card.style.display = match ? "block" : "none";
  });
}

loadPlans();
</script>

</body>
</html>
