<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>All Plans — Daily Fruit Co.</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{ --accent-from:#06b6d4; --accent-to:#7c3aed; }
  body{
    font-family:'Inter',sans-serif;
    background:linear-gradient(180deg,#f8fafc,#eef7ff);
    color:#0f172a;
  }

  .glass{
    background:rgba(255,255,255,0.95);
    border-radius:14px;
    border:1px solid rgba(148,163,184,0.18);
    padding:16px;
    box-shadow:0 10px 30px rgba(2,6,23,0.06);
    transition:.2s;
  }
  .glass:hover{
    transform:translateY(-4px);
    box-shadow:0 20px 40px rgba(2,6,23,0.10);
  }

  .promo-badge{
    padding:6px 10px;
    border-radius:999px;
    background:linear-gradient(90deg,#fb923c,#f97316);
    color:white;
    font-weight:700;
    font-size:12px;
    position:absolute;
    top:12px;
    right:12px;
  }

  .btn-checkout{
    background:linear-gradient(90deg,var(--accent-from),var(--accent-to));
    color:white;
    padding:10px 14px;
    border-radius:8px;
    font-weight:600;
  }

  #checkoutBar{
    position:fixed;
    bottom:0; left:0; right:0;
    background:white;
    border-top:1px solid #eef2f7;
    box-shadow:0 -6px 20px rgba(0,0,0,.08);
    padding:12px;
    z-index:50;
    transform:translateY(110%);
    opacity:0;
    transition:.25s;
  }
  #checkoutBar.visible{
    transform:translateY(0);
    opacity:1;
  }

  body.has-checkout{
    padding-bottom:90px;
  }
</style>
</head>

<body>

<header class="sticky top-0 bg-white/80 backdrop-blur border-b z-40">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-4">
    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-teal-400 flex items-center justify-center text-white font-bold">DF</div>
    <div>
      <div class="text-lg font-semibold">Daily Fruit Co.</div>
      <div class="text-xs text-gray-500">Freshness Delivered Daily</div>
    </div>
  </div>
</header>

<section class="max-w-6xl mx-auto px-4 py-8">
  <h1 class="text-3xl font-extrabold mb-1">All Subscription Plans</h1>
  <p class="text-gray-600">Choose based on your goal — weight loss, premium fruits, detox or daily immunity.</p>
</section>

<div id="plansGrid" class="max-w-6xl mx-auto px-4 grid md:grid-cols-2 lg:grid-cols-3 gap-6 pb-32">
  <div id="plansLoading" class="col-span-full text-gray-500">Loading plans…</div>
</div>

<!-- Sticky checkout bar -->
<div id="checkoutBar">
  <div class="max-w-5xl mx-auto flex items-center justify-between">
    <div>
      <div id="checkoutName" class="font-semibold"></div>
      <div id="checkoutMeta" class="text-xs text-gray-500"></div>
    </div>
    <div class="flex items-center gap-3">
      <div id="checkoutPrice" class="font-extrabold text-emerald-600 text-lg"></div>
      <button id="checkoutGo" class="btn-checkout">Checkout →</button>
      <button id="checkoutClose" class="text-2xl text-gray-400">×</button>
    </div>
  </div>
</div>

<script>
const API_BASE = "https://dailyfruit-backend.onrender.com";
const FALLBACK_IMAGE = "https://images.unsplash.com/photo-1572441710534-680f9c6b3f95?w=800&q=60";

const plansGrid = document.getElementById("plansGrid");
const plansLoading = document.getElementById("plansLoading");

const checkoutBar = document.getElementById("checkoutBar");
const checkoutName = document.getElementById("checkoutName");
const checkoutMeta = document.getElementById("checkoutMeta");
const checkoutPrice = document.getElementById("checkoutPrice");
const checkoutGo = document.getElementById("checkoutGo");
const checkoutClose = document.getElementById("checkoutClose");

const rupee = n => "₹" + Number(n||0).toLocaleString("en-IN");

async function loadPlans(){
  try{
    const res = await fetch(API_BASE + "/api/plans");
    const plans = await res.json();
    renderPlans(plans);
  }catch(e){
    plansGrid.innerHTML = "<div class='col-span-full text-red-500'>Failed to load plans</div>";
  }
}

function renderPlans(plans){
  plansGrid.innerHTML = "";
  plans.forEach(plan => {
    const billingDays = plan.billingDaysPerMonth || plan.durationDays || 30;
    const perDelivery = Math.round((plan.price||0) / billingDays);

    const card = document.createElement("div");
    card.className = "glass relative";

    card.innerHTML = `
      ${plan.promo ? `<div class="promo-badge">${plan.promo}</div>` : ""}
      <div class="flex gap-4">
        <img src="${plan.imageUrl || FALLBACK_IMAGE}" class="w-24 h-24 rounded-lg border object-cover"/>
        <div class="flex-1">
          <h3 class="font-semibold text-lg">${plan.name}</h3>
          <p class="text-xs text-gray-500 mt-1">${plan.description || ""}</p>

          <div class="mt-3">
            <div class="text-2xl font-extrabold text-emerald-600">${rupee(plan.price)}</div>
            <div class="text-xs text-gray-400">${plan.billingLabel || ""}</div>
            <div class="text-xs text-gray-500">≈ ${rupee(perDelivery)} / delivery</div>
          </div>

          <div class="mt-4">
            <button class="btn-checkout">Go to Checkout →</button>
          </div>
        </div>
      </div>
    `;

    card.querySelector("button").onclick = () => selectPlan(plan);
    plansGrid.appendChild(card);
  });
}

function selectPlan(plan){
  localStorage.setItem("df_selected_plan", JSON.stringify(plan));
  checkoutName.textContent = plan.name;
  checkoutMeta.textContent = plan.billingLabel || "";
  checkoutPrice.textContent = rupee(plan.price);

  checkoutGo.onclick = () => location.href = "checkout.html";

  document.body.classList.add("has-checkout");
  checkoutBar.classList.add("visible");
}

checkoutClose.onclick = () => {
  checkoutBar.classList.remove("visible");
  document.body.classList.remove("has-checkout");
  localStorage.removeItem("df_selected_plan");
};

document.addEventListener("DOMContentLoaded", loadPlans);
</script>

</body>
</html>
